kind: MassExecute
store_import:
  enabled: true
  data:
    # - key: "value1"
    #   bucket_id: "bucketForApp"
    #   store_key: "users"
    #   # global or thread only(default: global)
    #   thread_only: true
    - key: "usersList"
      bucket_id: "bucketForApp"
      store_key: "users"
      # encrypt:
      #   enabled: true
      #   encrypt_id: encryptDynamicCBC
type: http
output:
  enabled: true
  ids: 
    - outputLocalCSV
auth: 
  enabled: true
  auth_id: authForWeb
data:
  requests:
    - target_id: "apiServer"
      endpoint: "/user-profiles"
      method: POST
      interval: 500ms
      awaitPrevResponse: false
      queryParam: {}
      pathVariables: {}
      body:
    {{- if .Values.usersList }}
    {{- with index .Values.usersList .Dynamic.LoopCount }}
        userId: "{{ .uuid }}"
        name: "{{ .name }}"
        email: "{{ .email }}"
    {{- end }}
    {{- end }}
      successBreak:
        - count
        - time
        - statusCode/badRequest
      break:
        time: 2m
        count: 5
        sysError: true
        parseError: true
        writeError: true
        statusCode:
          - id: internalServerError
            op: eq
            value: 500
          - id: badRequest
            op: eq
            value: 400
      data:
        - key: "resultType"
          jmesPath: "data.resultType"
        - key: "memory_active"
          jmesPath: "data.result[*].value"
          onNil: "ignore" # cancel or ignore(default)
        - key: "invalid_key"
          jmesPath: "data.result[*].invalid_key"
          onNil: "ignore"
      dataOutputFilter:
        jmesPath: "code == '0002:0003'"
