kind: Flow
step:
  # if set to 0, it will run one by one in sequence,(default: 0)
  # if set to minus, it will run all the queries in sequence
  concurrency: 0
  flows:
    - id: "store"
      type: flow
      mkdir: false
      values:
        - key: "ThreadPerSlaveCount"
          value: 50
        - key: "RequestPerSlaveCount"
          value: 3000
        - key: "SlaveCount"
          value: 2
      concurrency: -1
      flows:
        # - id: "usersStore"
        #   type: file
        #   mkdir: false
        #   file: "sc/sc0/store.yaml"
        #   values: []
        #   thread_only_values: []
        # - id: "slaveStore"
        #   type: file
        #   mkdir: false
        #   file: "sc/slave/store.yaml"
        #   values: []
        #   thread_only_values: []
    - id: "import"
      type: flow
      mkdir: false
      concurrency: -1
      flows:
        - id: "slaveConnect"
          type: file
          mkdir: false
          file: "sc/slave/connect.yaml"
          values: []
          thread_only_values: []
        - id: "storeImport"
          type: file
          file: "sc/sc0/store_import.yaml"
          mkdir: false
          values: []
          thread_only_values: []
    - id: "main"
      type: flow
      mkdir: false
      concurrency: -1
      flows:
        - id: "metrics"
          type: file
          mkdir: true
          file: "sc/metrics/main.yaml"
          values:
            - key: "MetricsInterval"
              value: "5s"
            - key: "MetricsBreakTime"
              value: "10m"
          thread_only_values: []
        - id: "request"
          type: slaveCmd
          mkdir: true
          thread_only_values:
            - key: "Interval"
              value: "100ms"
            - key: "BreakTime"
              value: "5m"
          executors: # SlaveValues: index, slaveID
            {{- if .Values.slaveLists }}
            {{- range slice .Values.slaveLists 0 .Values.SlaveCount }}
            - slave_id: "{{ .id }}"
              output:
                enabled: true
                root_path: "{{ .id }}"
              inherit_values: true
              additional_values: []
              additional_thread_only_values: []
            {{- end }}
            {{- end }}
          file: "sc/sc1/main.yaml"